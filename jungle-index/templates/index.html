<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <!-- jQuery CDN 추가 -->

    <title>속성 on/off AJAX</title>
    <style>
        .btn {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #eee;
        }

        .on {
            background-color: #4CAF50;
            color: white;
        }

        .off {
            background-color: #f44336;
            color: white;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>

    <h2>속성 선택 (AJAX)</h2>

    <button class="btn off" onclick="toggle(this, 'Listening Music')">Listening Music</button>
    <button class="btn off" onclick="toggle(this, 'Weight Training')">Weight Training</button>
    <button class="btn off" onclick="toggle(this, 'Cooking')">Cooking</button>
    <button class="btn off" onclick="toggle(this, 'Chess')">Chess</button>
    <button class="btn off" onclick="toggle(this, 'Tennis')">Tennis</button>
    <button class="btn off" onclick="toggle(this, 'Soccer')">Soccer</button>
    <button class="btn off" onclick="toggle(this, 'Game')">Game</button>

    <button class="btn off" onclick="onSubmitClick()">제출</button>


    <script>
        function getOnButtons(){  //활성화된 버튼 가져오는 함수
            
            const buttons = document.querySelectorAll('button'); //버튼 type 받아오기
            const onNames = [];

            buttons.forEach(button => {
                const isOn = button.classList.contains('on'); //활성화 된 버튼만 가져오기 위한 상태 변수
                if(isOn){ //활성화 된 경우
                    const fullName = button.textContent.trim();
                    onNames.push(fullName);  //버튼 이름(속성값) 리스트에 추가
                }
            })
            return onNames;
        }

        function onSubmitClick(){   //제출 버튼이 클릭되었을 때 버튼을 받아와서 서버로 넘기는 함수
            const result = getOnButtons();
            console.log(result);
            sendList(result);            
        }

        function toggle(button, attrName) {
            const isOn = button.classList.contains('on');

            // 상태 전환
            if (isOn) {
                button.classList.remove('on');
                button.classList.add('off');
                button.textContent = `${attrName}`;
            } else {
                button.classList.remove('off');
                button.classList.add('on');
                button.textContent = `${attrName}`;
            }
            const state = button.classList.contains('on') ? 'on' : 'off';
        }
        
        function sendList(attrList){  //서버에 리스트 넘기는 함수
            console.log(attrList)  
            $.ajax({
                type:'POST',
                url: "/render_image",
                data: {attrList_give: attrList.join(',')}, //Flask request.form.get()으로 받을 때 문자열로 전송되어야 함
                success: function(response){
                    if(response['result'] != 'success') {
                        alert('fail');
                        return;
                    }
                    alert('success!');
                    console.log(response['attrList'])
                }
            })
        }
            // function saveModifying(id) {
            //     $.ajax({
            //         type: "POST",
            //         url: "/render_image",
            //         data: { id_give: id, title_give: new_title, content_give: new_content },
            //         success: function (response) {
            //             if (response['result'] != 'success') {
            //                 alert('수정 저장 실패!')
            //                 return
            //             }
            //             alert('수정 저장 성공')
            //             showcompletion()
            //         }
            //     });
            // }

    </script>

</body>

</html>